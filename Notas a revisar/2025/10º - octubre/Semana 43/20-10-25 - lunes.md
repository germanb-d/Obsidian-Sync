---
journal: Calendario
Diario-Fecha: 2025-10-20
---

# Clase 7 - Transacciones En Entornos Concurrentes

**Concurrente**: Múltiples operaciones al mismo tiempo y que pueden acceder al mismo dato.

## Seriabilidad

Si dos transacciones quieren manejar el mismo dato funcionan, primero se ejecutará una y después la otra, en serie.

Se vuelve inviable con el tiempo, por el tiempo que tardaría en ejecutarse.

![[20-10-25 - lunes-1760996594823.webp]]

Aunque el orden altera los resultados en A (100) y b (0). En ambos casos se mantiene la misma cantidad de dinero luego de las operaciones. 45+55 o 40 + 60 ambos es = 100

## Entornos Concurrentes

![[20-10-25 - lunes-1760997154192.webp]]

En el primer caso, al hacer el `WRITE` el dato se guarda en el buffer de la BD (en la memoria del DBMS), mientras que el segundo caso entre A= A-50 y el Write (A) se guarda en la memoria del proceso

`WRITE` : Pasa de la memoria del proceso a la memoria del DBMS

`OUTPUT`: Pasa de la memoria del DBMS al disco

Buscamos realizar transacciones concurrentes pero con la fiabilidad de una planificacion en serie

### Confilctos

Aquellas operaciones que modifican (`WRITE`) son las unicas que pueden generar conflicto.

Se verifican la seriabilidad, osea si son correctas las soluciones al conflicto, usando grafos de procerencia.

### Control De Concurrencia

#### Basado En Hora De Entrada

Jamas se usa en BD. Lo vemos porque esta en el plan de la materia.

#### Bloqueos

Es el mecanismo más utilizado para el control de concurrencia. Cada vez que usa el dato lo bloquea.

Si tenes el dato con la intencion de modificarlo se usa el Exclusivo Lock_e (dato), no permite ni leer ni escribir el dato por otras operaciones.

Si solo tenes el dato con la intencion de leerlo sin grabarla solo usa el Compartido Lock_c (dato). Permite que otras operaciones puedan leer el dato pero no modificarlo.

Una transacción debe:

Obtener el dato (si está libre, o compartido y solicita compartido)

Si no lo puede obtener: Esperar (o abortar)

Usar el dato

Liberarlo (commit o rollback /abort)

Los rollback son parecidos a las [[Excepciones|excepciones]] , si se cumple una excepcion se atrapa y se puede realizar un rollback.

#### DeadLock (Abrazo Mortal)

![[20-10-25 - lunes-1760999239628.webp]]

Reducir estos casos:

- Evitar que el usuario deba tomar decisiones para completar bloques bloqueados, puede ser q el usuario tarde mucho.
- #Buscar

#### Bloqueo En Dos Fases

Si yo uso quiero editar algo en vez de hacer un `lock_e`, `read`, editar todo y luego `Write`, me conviene usar un `lock_c`, `read` para que cualquier otra operación pueda seguir leyendo los datos. Los datos que yo vaya editando se guardan en la memoria de la operación, al terminar hago nuevo `lock_e` y vuelvo a `read` el dato y lo `write`.

# ACID

## Aislamiento (isolation)

PORQUE USA :=

# 03 / 11

Cuando hablamos de "Bloqueos de datos" hablamos de que bloquean tuplas

En una transacción de dinero se bloquean dos tuplas por ejemplo, una de donde sale y otra de donde entra el dinero, aun cuando el único dato que usea sea el saldo se bloquea toda la tupla. Por lo cual si yo  a la vez deseo cambiar el tipo de cuenta, no me lo permitira.

Tambien hay casos que pueden bloquear una o mas areas, una o mas tablas o una BD completa.

Casos como al levantar de una caida. Tambien hay casos mas cortos de bloqueos como al Insertar una fila, al delete una fila o al hacer un checkpoint.

Al hacer un DELETE de una fila (Departamento 4) va a verificar todos los empleados que tengan la clave foranea 4. Si lo encuentra se puede:

- Borrar en cascada: Borra todos esos empleados
- Te dice que primero elimines los empleados y luego el departamento
- Te pregunta si borrar empleados tambien
Por esto algunos DELETE pueden tardar mucho tiempo.

## CheckPoints

En entornos concurrentes no podre hacer un checkpoint si esto implica bajar TODO a disco. Me provocaria muchos retrasos.

Por lo cual se hace un checkpoint donde parte se bajara a disco y las demas se guardaran en una lista en este checkpoint avisando que listas quedaron en memoria.

Al tratarse de transacciones inmediatas puede que en ella lista haya transacciones que ya tengan `commit` pero aun no estan en disco.

 En caso de una caída, estas transacciones que no estan en disco se recuperarán desde la lista del checkpoint.  Los bloquea de escritura,  yy realiza el mismo procedimiento que hace con aquellas transacciones despues del checkpoint. Ver si tienen commit, roll back, undo, redo, etc.

Las transacciones con commit se rehacen (redo) y las que no lo tienen se deshacen (undo).

## Retroceso En Cascada

![[20-10-25 - lunes-1762207174515.webp]]

## Inanición

![[20-10-25 - lunes-1762207383626.webp]]

T 1 estara en inanición al encadenarse muchos bloqueos de lectura, que al ser mas prioritarios,  el bloqueo exclusivo de T 1 jamas se realiza.

A diferencia del bloqueo este se puede solucionar con el tiempo. Se puede solucionar con un sistema de prioridades o con un sistema de "primero en llegar, primero en ser atendido".

## Otros Errores Que no Veremos En la Materia

Seguridad: protección contra intentos mal intencionados para modificar datos

- Nivel físico
- Nivel humano
- Nivel SO
- Red
- DBMS

Transacciones monu y concurrente

SQL
